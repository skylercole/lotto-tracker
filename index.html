<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Value Tracker</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --accent: #4caf50; --danger: #ef5350; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; text-align: center; }
        h1 { margin-bottom: 30px; letter-spacing: 1px; }
        .grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; max-width: 1200px; margin: 0 auto; }
        .card { 
            background: var(--card); border-radius: 16px; padding: 25px; width: 300px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: transform 0.2s; border-top: 5px solid #555;
        }
        .card:hover { transform: translateY(-5px); }
        .jackpot { font-size: 2.2rem; font-weight: bold; margin: 15px 0; color: #fff; }
        .game-logo { width: 120px; height: 48px; object-fit: contain; margin: 0 auto 10px; display: block; }
        .roi-badge { 
            display: inline-block; padding: 8px 16px; border-radius: 20px; font-weight: bold; margin-bottom: 20px;
        }
        .good { background: rgba(76, 175, 80, 0.2); color: #66bb6a; border: 1px solid #4caf50; }
        .mid { background: rgba(255, 193, 7, 0.2); color: #ffd54f; border: 1px solid #ffca28; }
        .bad { background: rgba(244, 67, 54, 0.2); color: #ef5350; border: 1px solid #e57373; }
        
        .stat-row { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 8px; border-bottom: 1px solid #333; padding-bottom: 8px; }
        .stat-row:last-child { border: none; }
        .label { color: #888; }
        .timestamp { margin-top: 40px; color: #555; font-size: 0.8rem; }
    </style>
</head>
<body>

    <h1>ðŸ‡«ðŸ‡® Lottery Value Tracker</h1>
    <div id="app" class="grid">
        <p>Loading market data...</p>
    </div>
    <div class="timestamp" id="last-updated"></div>

    <script>
        async function loadData() {
            try {
                // Fetch the JSON file generated by Python
                const response = await fetch('lottery_data.json');
                const data = await response.json();
                render(data);
            } catch (error) {
                console.error("Error loading data:", error);
                document.getElementById('app').innerHTML = "<p>Could not load data. Ensure <code>lottery_data.json</code> exists.</p>";
            }
        }

        function calculateMetrics(game) {
            // 1. Jackpot EV (Jackpot / Odds)
            const jackpotEV = game.jackpot / game.odds_jackpot;
            
            // 2. Base EV (Expected return from smaller prizes)
            // Price * RTP for non-jackpot tiers
            const baseEV = game.price * game.base_rtp;
            
            // 3. Total EV
            const totalEV = jackpotEV + baseEV;

            // 4. ROIs
            const jackpotROI = ((jackpotEV / game.price) * 100).toFixed(1);
            const totalROI = ((totalEV / game.price) * 100).toFixed(1); // Usually expressed as Return % (e.g. 80%)

            return { jackpotROI, totalROI };
        }

        function formatFinnishDate(dateTime) {
            if (!dateTime) return '';
            const datePart = dateTime.split(' ')[0];
            const parts = datePart.split('-');
            if (parts.length !== 3) return datePart;
            return `${parts[2]}.${parts[1]}.${parts[0]}`;
        }

        function makeLogo(label, background, foreground) {
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="240" height="96" viewBox="0 0 240 96">
                    <rect width="240" height="96" rx="16" fill="${background}"/>
                    <text x="120" y="58" font-family="Segoe UI, Arial, sans-serif" font-size="28" font-weight="700" text-anchor="middle" fill="${foreground}">
                        ${label}
                    </text>
                </svg>
            `;
            return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
        }

        function getGameImage(gameName) {
            if (gameName.includes('Euro')) return makeLogo('EUROJACKPOT', '#f1c40f', '#1c1c1c');
            if (gameName.includes('Viking')) return makeLogo('VIKINGLOTTO', '#2196f3', '#ffffff');
            return makeLogo('LOTTO', '#ef5350', '#ffffff');
        }

        function render(data) {
            const container = document.getElementById('app');
            container.innerHTML = '';
            
            const updatedDate = formatFinnishDate(data.last_updated);
            document.getElementById('last-updated').innerText = "Last Updated: " + updatedDate;

            data.games.forEach(game => {
                const metrics = calculateMetrics(game);
                const isPositive = parseFloat(metrics.totalROI) > 100;
                const badgeClass = isPositive ? 'good' : (metrics.totalROI > 60 ? 'mid' : 'bad');
                const borderColor = isPositive ? '#4caf50' : (game.name.includes('Euro') ? '#e6b800' : (game.name.includes('Viking') ? '#2196f3' : '#ef5350'));

                const html = `
                    <div class="card" style="border-top-color: ${borderColor}">
                        <img class="game-logo" src="${getGameImage(game.name)}" alt="${game.name} logo" />
                        <!-- <h3>${game.name}</h3> -->
                        <div class="jackpot">â‚¬${(game.jackpot / 1000000).toFixed(1)}M</div>
                        <div class="roi-badge ${badgeClass}">
                            Total ROI: ${metrics.totalROI}%
                        </div>
                        
                        <div class="stat-row">
                            <span class="label">Jackpot Only ROI</span>
                            <span>${metrics.jackpotROI}%</span>
                        </div>
                        <div class="stat-row">
                            <span class="label">Ticket Price</span>
                            <span>â‚¬${game.price.toFixed(2)}</span>
                        </div>
                        <div class="stat-row">
                            <span class="label">Next Draw</span>
                            <span>${formatFinnishDate(game.next_draw)}</span>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        loadData();
    </script>
</body>
</html>